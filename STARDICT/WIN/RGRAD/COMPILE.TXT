/********************************************************************
-- STARDICT Project --
План программы-конвертора из файлов в формате RSTEXT 2.0 в файлы данных
(c) I.Vladimirsky 1997
********************************************************************/

класс Тэг
{
   КодТэга
//   Приоритет

   virtual Обработка()
   virtual ПолучитьАргументы()
}

класс ТэгСсылки : public Тэг
{
   НомерСтатьиСсылки;

   переопределение виртуальных ф-ий
}

...

класс ТэгИзмененияШрифта : public Тэг
{
   РазмерШрифита;
   АтрибутыШрифта;

   переопределение виртуальных ф-ий
}

Тэг ОбрабатыватьДоТэга()
{
   Пока (Читать_символ_из_input() != '<' )
       Писать_символ_в_output();

   ТипТэга = Читать_символ_из_input();
   switch( ТипТэга )
       Создать элемент соответствующего класса tag;

   tag.ПолучитьАргументы();
   return tag;
}

Тэг ОбрабатыватьДоТэга_buf( char* buffer)
{
   аналогична предыдущей ф-ии, но перенапр вывод в буффер.
}

Тэг.Обработка() для одинарных тэгов
{
   КодТэга -> output
   Параметры -> output
}

Тэг.Обработка() для двойных тэгов
{
   КодТэга -> output
   Параметры -> output

   Тэг tag = ОбрабатыватьДоТэга()

   if( tag - соответствующий закрывающий тэг)
       tag.Обработка();

   if( tag - может быть вложенным в данный )
       tag.Обработка()

   if( tag - не может быть вложенным в данный )
       Ошибка();
}

main()
{
  BOOL ПрочтеноЛиИмя, ПрочтенЛиНомер, ПрочтеноЛиТело  = NO;

  Пока ( (tag = ОбрабатыватьДоТэга()) != конец )
     {
        if(tag = имя)
         {
          if( ПрочтеноЛиИмя == NO)
              { ЧитатьИмяСтатьи(); ПрочтеноЛиИмя = YES; }
          else
              ОШИБКА()
         }

        if(tag = номер)
         {
          if( ПрочтенЛиНомер == NO)
              { ЧитатьНомерСтатьи(); ПрочтенЛиНомер = YES; }
          else
              ОШИБКА()
         }

        if(tag = тело)
         {
          if( ПрочтеноЛиТело == NO)
              { ЧитатьТелоСтатьи(); ПрочтеноЛиТело = YES; }
          else
              ОШИБКА()
         }

     }

  if( ПрочтеноЛиИмя == NO || ПрочтенЛиНомер == NO || ПрочтеноЛиТело == NO )
         ОШИБКА();
}

ЧитатьИмя()
{
    char name[255];
    tag = ОбрабатыватьДоТэга_buf ( name );
    if( tag != конец_имени)  ОШИБКА();
}

ЧитатьНомер()
 аналогично предыдущей

ЧитатьТело()
{
    while(  (tag = ОбрабатыватьДоТэга()) != конец_тела_статьи )
        tag.Обработка();
}